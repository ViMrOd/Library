<!DOCTYPE html>
<html>
<head>
	<title>Library Admin Portal</title>
    <link rel="stylesheet" href="styles/global.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <header>
      <h1>Library Name</h1>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="books.html">Books</a></li>
          <li><a href="login.html">Login</a></li>
        </ul>
      </nav>
    </header>
	<h1>Library Admin Portal</h1>

	<label for="searchInput">Search customer:</label>
	<input type="text" id="searchInput" name="searchInput">
	<button id="searchButton">Search</button>

	<div id="customerInfo">
	</div>

	<script>
	$(document).ready(function() {
		$('#searchButton').on('click', function(e) {
            e.preventDefault();
			var searchInput = $('#searchInput').val();

			$.ajax({
				url: 'http://localhost:3000/user/' + searchInput,
				type: 'GET',
				dataType: 'json',
				success: function(data) {
					var customerInfoHtml = '';
					if (data) {
						var customer = data[0];
						customerInfoHtml += '<h2>Customer Info</h2>';
						customerInfoHtml += '<p>Username: ' + customer.username + '</p>';
						customerInfoHtml += '<p>Password: ' + customer.password + '</p>';
						customerInfoHtml += '<p>Is admin?: ' + customer.is_admin + '</p>';
                        customerInfoHtml += `<p>-------------------</p>`;
						customerInfoHtml += '<p>Checked out books: </p>';
                        customerInfoHtml += `<br>`;
                        data.forEach(checkout => {
                            customerInfoHtml += `<p>-------------------</p>`;
                            customerInfoHtml += `<p>title: ${checkout.title}</p>`;
                            customerInfoHtml += `<p>checkout date: ${checkout.checkout_date}</p>`;
                            customerInfoHtml += `<p>return date: ${checkout.return_date}</p>`;
                            customerInfoHtml += `<p>fine: ${checkout.fine}</p>`;
                            customerInfoHtml += `<div id="returnDateForm">
                                <label for="returnDateInput">Enter return date:</label>
                                <input type="date" id="returnDateInput" name="returnDateInput">
                                <button id="updateReturnDateButton">Update Return Date</button></div>`
                            customerInfoHtml += `<p>-------------------</p>`;
                        });
					} else {
						customerInfoHtml += '<p>No customer found with that ID.</p>';
					}

					$('#customerInfo').html(customerInfoHtml);
				},
				error: function() {
					$('#customerInfo').html('<p>Error searching for customer.</p>');
				}
			});
		});

		$('#updateReturnDateButton').on('click', function(e) {
			e.preventDefault();
			var searchInput = $('#searchInput').val();
			var returnDateInput = $('#returnDateInput').val();

			$.ajax({
				url: 'http://localhost:3000/user/' + searchInput + '/' + returnDateInput,
				type: 'PUT',
				success: function(data) {
					console.log(data);
					alert('Return date updated successfully.');
				},
				error: function(data) {
					alert("Return date must be after the checkout date");
				}
			});
		});
	});
	</script>
    <script src="utility/header-login-check.js"></script>
</body>
</html>

